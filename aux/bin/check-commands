#!/bin/bash

set -euo pipefail


################################################################################

function error {
    echo "ERROR: ${*}" >/dev/stderr
}

function os-flavor {
    # Make a subshell to avoid leaking variables
    # shellcheck disable=SC1091
    ( source /etc/os-release
      echo "${ID_LIKE:-${ID:-unknown-linux}}"
    )
}

function missing-commands {
    for cmd in "${@}"; do
        if ! command -v "${cmd}" &>/dev/null; then
            echo "${cmd}"
        fi
    done
}

function main {
    local -a cmds

    mapfile -t cmds < <( missing-commands "${@}" ); wait $!

    if [ "${#cmds[@]}" -eq 0 ]; then
        return
    fi

    error "Missing commands: ${cmds[*]}"
    echo
    return 1
}

main "${@}"; exit
